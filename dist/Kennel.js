'use strict';

var _depiction,_proxyURL,_tint,__classPrivateFieldSet=undefined&&undefined.__classPrivateFieldSet||function(e,i,t){if(!i.has(e))throw new TypeError("attempted to set private field on non-instance");return i.set(e,t),t},__classPrivateFieldGet=undefined&&undefined.__classPrivateFieldGet||function(e,i){if(!i.has(e))throw new TypeError("attempted to get private field on non-instance");return i.get(e)};const marked=require("marked");class Kennel{constructor(e,i){_depiction.set(this,void 0),_proxyURL.set(this,void 0),_tint.set(this,void 0);__classPrivateFieldSet(this,_depiction,void 0!==e?e:{minVersion:"0.1",tintColor:"#6264D3",class:"DepictionLabelView",text:"(This depiction is empty.)"}),__classPrivateFieldSet(this,_proxyURL,void 0!==i?i:""),__classPrivateFieldSet(this,_tint,void 0!==__classPrivateFieldGet(this,_depiction).tintColor?Kennel._sanitizeColor(__classPrivateFieldGet(this,_depiction).tintColor):"#6264d3");}render(){let e=`<div class="native_depiction"><style>a, .nd_tint, .nd_table-btn:after {color: ${__classPrivateFieldGet(this,_tint)}} .nd_active {color: ${__classPrivateFieldGet(this,_tint)}; border-bottom: 2px solid ${__classPrivateFieldGet(this,_tint)};} .nd_btn {background-color: ${__classPrivateFieldGet(this,_tint)}}</style>`;return e+=this._DepictionBaseView(__classPrivateFieldGet(this,_depiction)),e+="</div>",e}_DepictionBaseView(e){return "DepictionStackView"==e.class?this._DepictionStackView(e):"DepictionAutoStackView"==e.class?this._DepictionAutoStackView(e):"DepictionTabView"==e.class?this._DepictionTabView(e):"DepictionTableTextView"==e.class?this._DepictionTableTextView(e):"DepictionTableButtonView"==e.class?this._DepictionTableButtonView(e):"DepictionMarkdownView"==e.class?this._DepictionMarkdownView(e):"DepictionLabelView"==e.class?this._DepictionLabelView(e):"DepictionScreenshotsView"==e.class?this._DepictionScreenshotsView(e):"DepictionSpacerView"==e.class?this._DepictionSpacerView(e):"DepictionSeparatorView"==e.class?this._DepictionSeparatorView(e):"DepictionHeaderView"==e.class?this._DepictionHeaderView(e):"DepictionSubheaderView"==e.class?this._DepictionSubheaderView(e):"DepictionButtonView"==e.class?this._DepictionButtonView(e):"DepictionImageView"==e.class?this._DepictionImageView(e):"DepictionRatingView"==e.class?this._DepictionRatingView(e):"DepictionReviewView"==e.class?this._DepictionReviewView(e):"DepictionWebView"==e.class?this._DepictionWebView(e):"DepictionVideoView"==e.class?this._DepictionVideoView(e):"DepictionAdmobView"==e.class?this._DepictionAdmobView(e):-1!=e.class.toLowerCase().indexOf("hidden")?"":this._DepictionUnknownView(e)}_DepictionTabView(e){let i='<div class="nd_tabView">',t=Kennel._makeIdentifier("nd_tabView");i+='<div class="nd_nav">';for(let n=0;n<e.tabs.length;n++)i+=`<div class="${t} ${t}_tab_${n} nd_nav_btn nd_tweak_info_btn ${0==n?"nd_active":""}" onclick="ndChangeTab('.${t}_tab_${n}', '.${t}')">${Kennel._sanitize(e.tabs[n].tabname)}</div>`;i+="</div>",i+="<div>";for(let n=0;n<e.tabs.length;n++)i+=`<div class="nd_tab ${t} ${t}_tab_${n} ${n>0?"nd_hidden":""}">`,i+=this._DepictionBaseView(e.tabs[n]),i+="</div>";return i+="</div></div>",i}_DepictionStackView(e){let i="";if(void 0!==e.backgroundColor?i+=`<div class="nd_nested_stack" style="background: ${Kennel._sanitize(e.backgroundColor)}">`:i+='<div class="nd_nested_stack">',void 0===e.orientation||"landscape"!=e.orientation.toLowerCase())for(let t=0;t<e.views.length;t++)i+=this._DepictionBaseView(e.views[t]);else {i+='<div class="nd_landscape_stack">';for(let t=0;t<e.views.length;t++)i+=this._DepictionBaseView(e.views[t]);i+="</div>";}return i+="</div>",i}_DepictionAutoStackView(e){let i="";if(void 0!==e.backgroundColor?i+=`<div class="nd_nested_stack" style="background: ${Kennel._sanitize(e.backgroundColor)}; width: ${Kennel._sanitize(e.horizontalSpacing?e.horizontalSpacing+"px":"100%")}">`:i+=`<div class="nd_nested_stack" style="width: ${Kennel._sanitize(e.horizontalSpacing?e.horizontalSpacing+"px":"100%")}">`,void 0===e.orientation||"landscape"!=e.orientation.toLowerCase())for(let t=0;t<e.views.length;t++)i+=this._DepictionBaseView(e.views[t]);else {i+='<div class="nd_landscape_stack">';for(let t=0;t<e.views.length;t++)i+=this._DepictionBaseView(e.views[t]);i+="</div>";}return i+="</div>",i}_DepictionTableTextView(e){return `<div class="nd_table"><div class="nd_cell"><div class="nd_title">${Kennel._sanitize(e.title)}</div><div class="nd_text">${Kennel._sanitize(e.text)}</div></div></div>`}_DepictionTableButtonView(e){let i="";return e.openExternal&&(i+=' target="_blank"'),(e.yPadding||e.tintColor)&&(i+=' style="',e.yPadding&&(i+=`padding-bottom: '${Kennel._sanitize(e.yPadding)}';`),e.tintColor&&(i+=`color: ${Kennel._sanitizeColor(e.tintColor)};`),i+='"'),e.action=Kennel._sanitize(Kennel._buttonLinkHandler(e.action,e.title)),`<a class="nd nd_table-btn" href="${e.action}"${i}><div>${e.title}</div></a>`}_DepictionButtonView(e){let i="";return e.openExternal&&(i+=' target="_blank"'),(e.yPadding||e.tintColor)&&(i+=' style="',e.yPadding&&(i+=`padding-bottom: '${Kennel._sanitize(e.yPadding)}';`),e.tintColor&&(i+=`background-color: ${Kennel._sanitizeColor(e.tintColor)};`),i+='"'),e.action=Kennel._sanitize(Kennel._buttonLinkHandler(e.action,e.text)),`<a class="nd nd_btn" href="${e.action}"${i}>${e.text}</a>`}_DepictionMarkdownView(e){let i=Kennel._makeIdentifier("md");void 0===e.tintColor&&void 0===__classPrivateFieldGet(this,_tint)?e.tintColor="#6264D3":void 0===e.tintColor&&void 0!==__classPrivateFieldGet(this,_tint)&&(e.tintColor=__classPrivateFieldGet(this,_tint));let t,n,a='<p style="opacity:0.3">[Warning: This depiction may be trying to maliciously run code in your browser.]</p><br>';if(e.useRawFormat?(t=marked(e.markdown).replace(/<hr>/g,this._DepictionSeparatorView(e)),-1!=t.toLowerCase().indexOf("<script>")&&(t=`${a}${t}`,t=t.substring(0,t.toLowerCase().indexOf("<script>")+7)+t.substring(t.toLowerCase().indexOf("<\/script>"))),-1==t.toLowerCase().indexOf("onload")&&-1==t.toLowerCase().indexOf("onerror")&&-1==t.toLowerCase().indexOf("onhover")&&-1==t.toLowerCase().indexOf("onclick")||(t=`${a}${t}`,t=t.replace(/onload/i,"").replace(/onerror/i,"").replace(/onhover/i,"").replace(/onclick/i,""))):t=marked(Kennel._lax_sanitize(e.markdown)).replace(/<hr>/g,this._DepictionSeparatorView(e)),-1!=t.indexOf("<style>")){let e=t.substring(t.indexOf("<style>")+7,t.indexOf("</style>"));e=e.replace(/body/g,"root").replace(/html/g,"root"),t=t.substring(0,t.indexOf("<style>")+7)+e+t.substring(t.indexOf("</style>")),n=t.substring(0,t.indexOf("<style>"))+t.substring(t.indexOf("</style>")+8);}else n=t;return `<div id="${i}" class="nd_md_view"><noscript>${n}</noscript><script>mdEl = document.createElement("sandboxed-markdown");let shadowRoot = mdEl.attachShadow({mode: 'open'});shadowRoot.innerHTML = \`<style>a {color:${Kennel._sanitizeColor(e.tintColor)};text-decoration: none} a:hover {opacity:0.8} h1, h2, h3, h4, h5, h6, p {margin-top: 5px; margin-bottom: 5px;}</style><root>${t}</root>\`;el = document.getElementById("${i}");el.appendChild(mdEl);el.removeAttribute("id");el.removeChild(el.children[0]);el.removeChild(el.children[0]);<\/script></div>`}_DepictionLabelView(e){let i;return i=void 0!==e.margins?Kennel._marginResolver(e.margins):"",e.alignment=Kennel._alignmentResolver(e.alignment),e.fontWeight=Kennel._weightStringResolver(e.fontWeight),e.textColor=void 0!==e.textColor?`color: ${Kennel._sanitize(e.textColor)};`:"",e.fontSize=void 0!==e.fontSize?`font-size: ${Kennel._sanitize(e.fontSize)}px;`:"",`<div class="nd_label" style="font-weight: ${e.fontWeight}; text-align:${e.alignment}; ${e.textColor}${e.fontSize}${i}">${Kennel._sanitize(e.text)}</div>`}_DepictionScreenshotsView(e){let i='<div class="nd_scroll_view">',t=e.itemSize.substring(1,e.itemSize.length-1).split(","),n=Number(t[0]),a=Number(t[1]),o="";o=n>a?`width: ${Kennel._sanitize(n)}px`:`height: ${Kennel._sanitize(a)}px`;for(let t=0;t<e.screenshots.length;t++){let n=Kennel._lax_sanitize(`${__classPrivateFieldGet(this,_proxyURL)}${e.screenshots[t].url}`);i+=`<img style="${Kennel._sanitize(o)}; border-radius: ${Kennel._sanitize(e.itemCornerRadius)}px" class="nd_img_card" alt="${Kennel._sanitize(e.screenshots[t].accessibilityText)}" src="${n}">`;}return i+="</div>",i}_DepictionSpacerView(e){return `<div class="nd_br" style="padding-top: ${e.spacing}px"></div>`}_DepictionSeparatorView(e){return '<div class="nd_hr_wrap"><hr></div>'}_DepictionHeaderView(e){return e.fontWeight="bold",void 0!==e.useBoldText&&(e.fontWeight=e.useBoldText?"bold":"normal"),`<h3 class="nd_header" style="text-align: ${Kennel._alignmentResolver(e.alignment)};font-weight: ${Kennel._sanitize(e.fontWeight)}">${Kennel._sanitize(e.title)}</h3>`}_DepictionSubheaderView(e){return e.fontWeight="normal",void 0!==e.useBoldText&&(e.fontWeight=e.useBoldText?"bold":"normal"),`<h4 class="nd_header" style="text-align: ${Kennel._alignmentResolver(e.alignment)};font-weight: ${Kennel._sanitize(e.fontWeight)}">${Kennel._sanitize(e.title)}</h4>`}_DepictionImageView(e){let i=Kennel._lax_sanitize(`${__classPrivateFieldGet(this,_proxyURL)}${e.URL}`),t=void 0!==e.horizontalPadding?`padding-top:${Kennel._sanitize(e.horizontalPadding)}px;padding-bottom:${Kennel._sanitize(e.horizontalPadding)}px;`:"";return e.alignment=Kennel._alignmentResolver(e.alignment),`<div style="text-align:${e.alignment};"><img src="${i}" style="width:${Kennel._sanitize(e.width)}px;height:${Kennel._sanitize(e.height)}px;border-radius:${Kennel._sanitize(e.cornerRadius)}px;max-width:100%;${t}" alt="Image from depiction."></div>`}_DepictionRatingView(e){let i=Kennel._starString(e.rating);return e.alignment=Kennel._alignmentResolver(e.alignment),`<div style="color:#a1a1a1; text-align:${e.alignment};">${i}</div>`}_DepictionReviewView(e){let i,t=this._DepictionMarkdownView(e);return i=void 0!==e.rating?this._DepictionRatingView(e):"",`<div class="nd_review"><div class="nd_review_head"><div class="nd_left"><p>${Kennel._sanitize(e.title)}</p><p class="nd_author">by ${Kennel._sanitize(e.author)}</p></div><div class="nd_right">${i}</div></div>${t}</div>`}_DepictionWebView(e){return e.alignment=Kennel._alignmentResolver(e.alignment),/(https?\:\/\/(((.*)\.vimeo.com)|(vimeo.com)|((.*)\.youtube.com)|(youtube.com))\/)/g.test(e.URL)?`<div style="text-align: ${e.alignment}"><iframe class="nd_max_width" src="${Kennel._lax_sanitize(e.URL)}" style="width: ${Kennel._sanitize(e.width)}px; height: ${Kennel._sanitize(e.height)}px;"></iframe></div>`:""}_DepictionVideoView(e){return `<div style="text-align: ${Kennel._alignmentResolver(e.alignment)};"><video class="nd_max_width" controls style="border-radius: ${Kennel._sanitize(e.cornerRadius)}px;" src="${Kennel._lax_sanitize(e.URL)}" width="${Kennel._sanitize(e.width)}" height="${Kennel._sanitize(e.height)}"></video></div>`}_DepictionAdmobView(e){return ""}_DepictionUnknownView(e){return `<p style="opacity:0.3">[Could not render: ${Kennel._sanitize(e.class)}]</p>`}static _sanitizeAll(e){e=String(e);let i="";for(let t=0;t<e.length;t++)i+=`&#x${Kennel._zeroPad(e.charCodeAt(t).toString(16))};`;return i}static _sanitize(e){e=String(e);let i="";for(let t=0;t<e.length;t++){let n=e[t];i+=n>="A"&&n<="z"||n>="0"&&n<="9"?n:`&#x${Kennel._zeroPad(n.charCodeAt(0).toString(16))};`;}return i}static _sanitizeColor(e){e=String(e);let i="";for(let t=0;t<e.length;t++){let n=e[t];i+=n>="A"&&n<="z"||n>="0"&&n<="9"||"#"==n||"("==n||")"==n?n:`&#x${Kennel._zeroPad(n.charCodeAt(0).toString(16))};`;}return i}static _lax_sanitize(e){e=String(e);let i="";for(let t=0;t<e.length;t++){let n=e[t];i+="&"==n||"<"==n||">"==n||'"'==n||"'"==n||"`"==n||"\\"==n||"/"==n?`&#x${Kennel._zeroPad(n.charCodeAt(0).toString(16))};`:n;}return i}static _sanitizeLegal(e){e=String(e);let i="";for(let t=0;t<e.length;t++){let n=e[t];i+=n>="A"&&n<="z"||n>="0"&&n<="9"?n:"_"+Kennel._zeroPad(n.charCodeAt(0).toString(16));}return i}static _zeroPad(e){let i=String(e).length;return 0==i?"0000":1==i?"000"+e:2==i?"00"+e:3==i?"0"+e:e}static _makeIdentifier(e){return void 0===e&&(e="nd"),`${e}_${Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(36)}`}static _starString(e){let i,t="";for(i=0;i<Math.floor(e);i++)t+="★";for(e%1!=0&&(t+="★"),i=Math.ceil(e);i<5;i++)t+="☆";return t}static _weightStringResolver(e){return void 0===e?"normal":"normal"==(e=e.toLowerCase())||"bold"==e||"bolder"==e||"lighter"==e?e:"ultralight"==e?"100":"thin"==e?"200":"light"==e?"300":"book"==e?"400":"semibold"==e||"Demibold"==e||"medium"==e?"600":"heavy"==e?"800":"black"==e||"extrablack"==e?"900":void 0}static _marginResolver(e){let i=JSON.parse(e.replace("{","[").replace("}","]"));return `margin: ${i[0]}px, ${i[3]}px, ${i[2]}px, ${i[1]}px;`}static _alignmentResolver(e){return 0==e?"left":1==e?"center":2==e?"right":"left"}static _buttonLinkHandler(e,i){return 0==e.indexOf("depiction-")?(void 0===i&&(i="Depiction"),`https://api.parcility.co/render/headerless?url=${e=e.substring(10)}&name=${i}`):0==e.indexOf("form-")?e.substring(4):e}}_depiction=new WeakMap,_proxyURL=new WeakMap,_tint=new WeakMap;

module.exports = Kennel;
