'use strict';

var _depiction,_proxyURL,_tint,__classPrivateFieldSet=undefined&&undefined.__classPrivateFieldSet||function(i,t,e){if(!t.has(i))throw new TypeError("attempted to set private field on non-instance");return t.set(i,e),e},__classPrivateFieldGet=undefined&&undefined.__classPrivateFieldGet||function(i,t){if(!t.has(i))throw new TypeError("attempted to get private field on non-instance");return t.get(i)};const marked=require("marked");class Kennel{constructor(i,t){_depiction.set(this,void 0),_proxyURL.set(this,void 0),_tint.set(this,void 0);__classPrivateFieldSet(this,_depiction,void 0!==i?i:{minVersion:"0.1",tintColor:"#6264D3",class:"DepictionLabelView",text:"(This depiction is empty.)"}),__classPrivateFieldSet(this,_proxyURL,void 0!==t?t:""),__classPrivateFieldSet(this,_tint,void 0!==__classPrivateFieldGet(this,_depiction).tintColor?this._sanitizeColor(__classPrivateFieldGet(this,_depiction).tintColor):"#6264d3");}render(){let i=`<div class="native_depiction"><style>a, .tint, .table-btn:after {color: ${__classPrivateFieldGet(this,_tint)}} .active {color: ${__classPrivateFieldGet(this,_tint)}; border-bottom: 2px solid ${__classPrivateFieldGet(this,_tint)};} .btn {background-color: ${__classPrivateFieldGet(this,_tint)}}</style>`;return i+=this._DepictionBaseView(__classPrivateFieldGet(this,_depiction)),i+="</div>",i}_DepictionBaseView(i){return "DepictionStackView"==i.class?this._DepictionStackView(i):"DepictionAutoStackView"==i.class?this._DepictionAutoStackView(i):"DepictionTabView"==i.class?this._DepictionTabView(i):"DepictionTableTextView"==i.class?this._DepictionTableTextView(i):"DepictionTableButtonView"==i.class?this._DepictionTableButtonView(i):"DepictionMarkdownView"==i.class?this._DepictionMarkdownView(i):"DepictionLabelView"==i.class?this._DepictionLabelView(i):"DepictionScreenshotsView"==i.class?this._DepictionScreenshotsView(i):"DepictionSpacerView"==i.class?this._DepictionSpacerView(i):"DepictionSeparatorView"==i.class?this._DepictionSeparatorView(i):"DepictionHeaderView"==i.class?this._DepictionHeaderView(i):"DepictionSubheaderView"==i.class?this._DepictionSubheaderView(i):"DepictionButtonView"==i.class?this._DepictionButtonView(i):"DepictionImageView"==i.class?this._DepictionImageView(i):"DepictionRatingView"==i.class?this._DepictionRatingView(i):"DepictionReviewView"==i.class?this._DepictionReviewView(i):"DepictionWebView"==i.class?this._DepictionWebView(i):"DepictionVideoView"==i.class?this._DepictionVideoView(i):"DepictionAdmobView"==i.class?this._DepictionAdmobView(i):-1!=i.class.toLowerCase().indexOf("hidden")?"":this._DepictionUnknownView(i)}_DepictionTabView(i){let t='<div class="nd_tabView">',e=this._makeIdentifier("nd_tabView");t+='<div class="nav">';for(let n=0;n<i.tabs.length;n++)t+=`<div class="${e} ${e}_tab_${n} nav_btn tweak_info_btn ${0==n?"active":""}" onclick="changeTab('.${e}_tab_${n}', '.${e}')">${this._sanitize(i.tabs[n].tabname)}</div>`;t+="</div>",t+="<div>";for(let n=0;n<i.tabs.length;n++)t+=`<div class="nd_tab ${e} ${e}_tab_${n} ${n>0?"hidden":""}">`,t+=this._DepictionBaseView(i.tabs[n]),t+="</div>";return t+="</div></div>",t}_DepictionStackView(i){let t="";if(void 0!==i.backgroundColor?t+=`<div class="nested_stack" style="background: ${this._sanitize(i.backgroundColor)}">`:t+='<div class="nested_stack">',void 0===i.orientation||"landscape"!=i.orientation.toLowerCase())for(let e=0;e<i.views.length;e++)t+=this._DepictionBaseView(i.views[e]);else {t+='<div class="landscape_stack">';for(let e=0;e<i.views.length;e++)t+=this._DepictionBaseView(i.views[e]);t+="</div>";}return t+="</div>",t}_DepictionAutoStackView(i){let t="";if(void 0!==i.backgroundColor?t+=`<div class="nested_stack" style="background: ${this._sanitize(i.backgroundColor)}; width: ${this._sanitize(i.horizontalSpacing?i.horizontalSpacing+"px":"100%")}">`:t+=`<div class="nested_stack" style="width: ${this._sanitize(i.horizontalSpacing?i.horizontalSpacing+"px":"100%")}">`,void 0===i.orientation||"landscape"!=i.orientation.toLowerCase())for(let e=0;e<i.views.length;e++)t+=this._DepictionBaseView(i.views[e]);else {t+='<div class="landscape_stack">';for(let e=0;e<i.views.length;e++)t+=this._DepictionBaseView(i.views[e]);t+="</div>";}return t+="</div>",t}_DepictionTableTextView(i){return `<div class="table"><div class="cell"><div class="title">${this._sanitize(i.title)}        </div><div class="text">${this._sanitize(i.text)}</div></div></div>`}_DepictionTableButtonView(i){let t="";return i.openExternal&&(t+=' target="_blank"'),(i.yPadding||i.tintColor)&&(t+=' style="',i.yPadding&&(t+=`padding-bottom: '${this._sanitize(i.yPadding)}';`),i.tintColor&&(t+=`color: ${this._sanitizeColor(i.tintColor)};`),t+='"'),i.action=this._sanitize(this._buttonLinkHandler(i.action,i.title)),`<a class="table-btn" href="${i.action}"${t}><div>${i.title}</div></a>`}_DepictionButtonView(i){let t="";return i.openExternal&&(t+=' target="_blank"'),(i.yPadding||i.tintColor)&&(t+=' style="',i.yPadding&&(t+=`padding-bottom: '${this._sanitize(i.yPadding)}';`),i.tintColor&&(t+=`background-color: ${this._sanitizeColor(i.tintColor)};`),t+='"'),i.action=this._sanitize(this._buttonLinkHandler(i.action,i.text)),`<a class="btn" href="${i.action}"${t}>${i.text}</a>`}_DepictionMarkdownView(i){let t=this._makeIdentifier("md");void 0===i.tintColor&&void 0===__classPrivateFieldGet(this,_tint)?i.tintColor="#6264D3":void 0===i.tintColor&&void 0!==__classPrivateFieldGet(this,_tint)&&(i.tintColor=__classPrivateFieldGet(this,_tint));let e,n,s='<p style="opacity:0.3">[Warning: This depiction may be trying to maliciously run code in your browser.]</p><br>';if(i.useRawFormat?(e=marked(i.markdown).replace(/<hr>/g,this._DepictionSeparatorView(i)),-1!=e.toLowerCase().indexOf("<script>")&&(e=`${s}${e}`,e=e.substring(0,e.toLowerCase().indexOf("<script>")+7)+e.substring(e.toLowerCase().indexOf("<\/script>"))),-1==e.toLowerCase().indexOf("onload")&&-1==e.toLowerCase().indexOf("onerror")&&-1==e.toLowerCase().indexOf("onhover")&&-1==e.toLowerCase().indexOf("onclick")||(e=`${s}${e}`,e=e.replace(/onload/i,"").replace(/onerror/i,"").replace(/onhover/i,"").replace(/onclick/i,""))):e=marked(this._lax_sanitize(i.markdown)).replace(/<hr>/g,this._DepictionSeparatorView(i)),-1!=e.indexOf("<style>")){let i=e.substring(e.indexOf("<style>")+7,e.indexOf("</style>"));i=i.replace(/body/g,"root").replace(/html/g,"root"),e=e.substring(0,e.indexOf("<style>")+7)+i+e.substring(e.indexOf("</style>")),n=e.substring(0,e.indexOf("<style>"))+e.substring(e.indexOf("</style>")+8);}else n=e;return `<div id="${t}" class="md_view"><noscript>${n}</noscript><script>var mdEl = document.createElement("sandboxed-markdown");var shadowRoot = mdEl.attachShadow({mode: 'open'});shadowRoot.innerHTML = \`<style>a {color:${this._sanitizeColor(i.tintColor)};text-decoration: none} a:hover {opacity:0.8} h1, h2, h3, h4, h5, h6, p {margin-top: 5px; margin-bottom: 5px;}</style><root>${e}</root>\`;el = document.getElementById("${t}");el.appendChild(mdEl);el.removeAttribute("id");el.removeChild(el.children[0]);el.removeChild(el.children[0]);<\/script></div>`}_DepictionLabelView(i){let t;return t=void 0!==i.margins?this._marginResolver(i.margins):"",i.alignment=this._alignmentResolver(i.alignment),i.fontWeight=this._weightStringResolver(i.fontWeight),i.textColor=void 0!==i.textColor?`color: ${this._sanitize(i.textColor)};`:"",i.fontSize=void 0!==i.fontSize?`font-size: ${this._sanitize(i.fontSize)}px;`:"",`<div class="label" style="font-weight: ${i.fontWeight}; text-align:${i.alignment}; ${i.textColor}${i.fontSize}${t}">${this._sanitize(i.text)}</div>`}_DepictionScreenshotsView(i){let t='<div class="scroll_view">',e=i.itemSize.substring(1,i.itemSize.length-1).split(","),n=Number(e[0]),s=Number(e[1]),o="";o=n>s?`width: ${this._sanitize(n)}px`:`height: ${this._sanitize(s)}px`;for(let e=0;e<i.screenshots.length;e++){let n=this._lax_sanitize(`${__classPrivateFieldGet(this,_proxyURL)}${i.screenshots[e].url}`);t+=`<img style="${this._sanitize(o)}; border-radius: ${this._sanitize(i.itemCornerRadius)}px" class="img_card" alt="${this._sanitize(i.screenshots[e].accessibilityText)}" src="${n}">`;}return t+="</div>",t}_DepictionSpacerView(i){return `<div class="br" style="padding-top: ${i.spacing}px"></div>`}_DepictionSeparatorView(i){return '<div class="hr_wrap"><hr></div>'}_DepictionHeaderView(i){return i.fontWeight="bold",void 0!==i.useBoldText&&(i.fontWeight=i.useBoldText?"bold":"normal"),`<h3 style="text-align: ${this._alignmentResolver(i.alignment)};font-weight: ${this._sanitize(i.fontWeight)}">${this._sanitize(i.title)}</h3>`}_DepictionSubheaderView(i){return i.fontWeight="normal",void 0!==i.useBoldText&&(i.fontWeight=i.useBoldText?"bold":"normal"),`<h4 style="text-align: ${this._alignmentResolver(i.alignment)};font-weight: ${this._sanitize(i.fontWeight)}">${this._sanitize(i.title)}</h4>`}_DepictionImageView(i){let t=this._lax_sanitize(`${__classPrivateFieldGet(this,_proxyURL)}${i.URL}`),e=void 0!==i.horizontalPadding?`padding-top:${this._sanitize(i.horizontalPadding)}px;padding-bottom:${this._sanitize(i.horizontalPadding)}px;`:"";return i.alignment=this._alignmentResolver(i.alignment),`<div style="text-align:${i.alignment};"><img src="${t}" style="width:${this._sanitize(i.width)}px;height:${this._sanitize(i.height)}px;border-radius:${this._sanitize(i.cornerRadius)}px;max-width:100%;${e}" alt="Image from depiction."></div>`}_DepictionRatingView(i){let t=this._starString(i.rating);return i.alignment=this._alignmentResolver(i.alignment),`<div style="color:#a1a1a1; text-align:${i.alignment};">${t}</div>`}_DepictionReviewView(i){let t,e=this._DepictionMarkdownView(i);return t=void 0!==i.rating?this._DepictionRatingView(i):"",`<div class="review"><div class="review_head"><div class="left"><p>${this._sanitize(i.title)}</p><p class="author">by ${this._sanitize(i.author)}</p></div><div class="right">${t}</div></div>${e}</div>`}_DepictionWebView(i){return i.alignment=this._alignmentResolver(i.alignment),/(https?\:\/\/(((.*)\.vimeo.com)|(vimeo.com)|((.*)\.youtube.com)|(youtube.com))\/)/g.test(i.URL)?`<div style="text-align: ${i.alignment}"><iframe src="${this._lax_sanitize(i.URL)}" style="width: ${this._sanitize(i.width)}px; height: ${this._sanitize(i.height)}px;"></iframe></div>`:""}_DepictionVideoView(i){return `<div style="text-align: ${this._alignmentResolver(i.alignment)};"><video controls style="border-radius: ${this._sanitize(i.cornerRadius)}px;" src="${this._lax_sanitize(i.URL)}" width="${this._sanitize(i.width)}" height="${this._sanitize(i.height)}"></video></div>`}_DepictionAdmobView(i){return ""}_DepictionUnknownView(i){return `<p style="opacity:0.3">[Could not render: ${this._sanitize(i.class)}]</p>`}_sanitizeAll(i){i=String(i);let t="";for(var e=0;e<i.length;e++)t+=`&#x${this._zeroPad(i.charCodeAt(e).toString(16))};`;return t}_sanitize(i){i=String(i);let t="";for(var e=0;e<i.length;e++){let n=i[e];t+=n>="A"&&n<="z"||n>="0"&&n<="9"?n:`&#x${this._zeroPad(n.charCodeAt(0).toString(16))};`;}return t}_sanitizeColor(i){i=String(i);let t="";for(var e=0;e<i.length;e++){let n=i[e];t+=n>="A"&&n<="z"||n>="0"&&n<="9"||"#"==n||"("==n||")"==n?n:`&#x${this._zeroPad(n.charCodeAt(0).toString(16))};`;}return t}_lax_sanitize(i){i=String(i);let t="";for(var e=0;e<i.length;e++){let n=i[e];t+="&"==n||"<"==n||">"==n||'"'==n||"'"==n||"`"==n||"\\"==n||"/"==n?`&#x${this._zeroPad(n.charCodeAt(0).toString(16))};`:n;}return t}_sanitizeLegal(i){i=String(i);let t="";for(var e=0;e<i.length;e++){let n=i[e];t+=n>="A"&&n<="z"||n>="0"&&n<="9"?n:"_"+this._zeroPad(n.charCodeAt(0).toString(16));}return t}_zeroPad(i){let t=String(i).length;return 0==t?"0000":1==t?"000"+i:2==t?"00"+i:3==t?"0"+i:i}_makeIdentifier(i){return void 0===i&&(i="nd"),`${i}_${Math.floor(Math.random()*Number.MAX_VALUE).toString(36)}`}_starString(i){let t,e="";for(t=0;t<Math.floor(i);t++)e+="★";for(i%1!=0&&(e+="★"),t=Math.ceil(i);t<5;t++)e+="☆";return e}_weightStringResolver(i){return void 0===i?"normal":"normal"==(i=i.toLowerCase())||"bold"==i||"bolder"==i||"lighter"==i?i:"ultralight"==i?"100":"thin"==i?"200":"light"==i?"300":"book"==i?"400":"semibold"==i||"Demibold"==i||"medium"==i?"600":"heavy"==i?"800":"black"==i||"extrablack"==i?"900":void 0}_marginResolver(i){let t=JSON.parse(i.replace("{","[").replace("}","]"));return `margin: ${t[0]}px, ${t[3]}px, ${t[2]}px, ${t[1]}px;`}_alignmentResolver(i){return 0==i?"left":1==i?"center":2==i?"right":"left"}_buttonLinkHandler(i,t){return 0==i.indexOf("depiction-")?(void 0===t&&(t="Depiction"),`https://api.parcility.co/render/headerless?url=${i=i.substring(10)}&name=${t}`):0==i.indexOf("form-")?i.substring(4):i}}_depiction=new WeakMap,_proxyURL=new WeakMap,_tint=new WeakMap;

module.exports = Kennel;
